# DS-Zigzager
Советник для MetaTrader 5. Торгует от уровней стандартного индикатора ZigZag от MetaQuotes. 
* Разработчик: Denis Kislitsyn | denis@kislitsyn.me | [kislitsyn.me](https://kislitsyn.me)
* Версия: 0.0.1

## Установка
1. Убедитесь, что ваш терминал MetaTrader 5 обновлен до последней версии. Для тестирования советников рекомендуется обновить терминал до самой последней бета-версии. Для этого запустите обновление из главного меню `Help->Check For Updates->Latest Beta Version`. На прошлых версиях советник может не запускаться, потому что скомпилирован на последней версии терминала. В этом случае вы увидите сообщения на вкладке `Journal` об этом.
2. Скопируйте исполняемый файл бота `*.ex5` в каталог данных терминала `MQL5\Experts\`.
3. Откройте график пары.
4. Переместите советника из окна Навигатор на график.
5. Установите в настройках бота галочку `Allow Auto Trading`.
6. Включите режим автоторговли в терминале, нажав кнопку `Algo Trading` на главной панели инструментов.

## Стратегия
Советник копирует торговую стратегию советника [ZigZager](https://www.youtube.com/watch?v=Dfv9tAbMBIA) для MT4.
> **ВНИМАНИЕ! ВАЖНО:** 
> 1. Пресеты от исходного советника для MT4 могут быть загружены и в эту версию советника.
> 2. ==Для некоторых торговых пар настройки для MT4 могут сильно отличаться в MT5 или для вашего конкретного брокера.== Например, настройки исходного советника для XAUUSD сделаны с учетом 2-х знаков после запятой в MT4. Большая часть брокеров перешла на 3-и знака для золота. Поэтому все расстояния из настроек в пунктах должны быть пересчитаны в x10 раз.

![EA Chart Overview](img/UM001.%20Overview.png)

1. Советник строит индикатор ZigZag.
2. На ближайших уровнях устанавливает STOP ордера.
3. При срабатывании ордера открывает новый от ближайшего "не торгованного" уровня.
4. SL устанавливает в значение одного из индикаторов MA или PSAR в момент открытия ордера.
5. TP устанавливает либо на фиксированном расстоянии, либо на указанном уровне Fibo с основанием равным дистанции между текущим и прошлым экстремумом ZigZag.
6. SL сдвигается в безубыток на фиксированной дистанции от открытия.
7. Советник может управлять несколькими вариантами трейлинг стопа: 
    - Ступенчатый - после пересечения дистанции активации от открытия сдвигает SL ступенями указанной длины.
    - Ценовой канал - после пересечения дистанции активации от открытия сдвигает SL в HIGH или LOW нескольких последних свечей на M1.
    - По индикаторам MA и Fractals - включается сразу после пересечения цены открытия - сдвигает SL в текущее значение MA. 
    *Индикатор Fractals вероятно не используется в текущей версии MT4, поэтому и для MT5 не реализован.*
8. Советник может удалять отложки в указанное время (например, в ночную паузу).
9. Советник может закрывать прибыльные позиции в указанное время (например, перед окончанием торгового дня).
10. Советник может рисовать отслеживаемые уровни ZigZag вместе с их SL/TP на графике.

##  Настройки

### 2. Основные настройки
- [x] `gMagic`: Идентификатор ордеров
- [x] `gComment`: Дополнительный комментарий к ордерам
- [x] `SetTypePos`: Направление торговли
- [x] `Type_lot`: Направление торговли
- [x] `Lot`: Если лот фиксированный, то равен...
- [x] `Money_loss`: Если лот динамичный, то допустимый убыток.... $

### 3а. Настройки ZigZag
- [x] `gTimeFrameZZ`: Рабочий таймфрейм ZigZag
- [x] `gBarsBack`: Сколько баров в истории нужно для ZigZag
- [x] `ExtDepth`: Фильтр резких колебаний, бар
- [x] `ExtDeviation`: ZZ ExtDeviation
- [x] `ExtBackstep`: Мин.кол-во баров между экстремумами

### 3б. Настройки MA и ParabolicSAR
- [x] `gTimeFrameInd`: Рабочий таймфрейм индикаторов
- [x] `SetIndicator`: Выберите дополнительный индикатор
- [x] `maPeriod`: Период Moving Average, если он выбран
- [x] `ParabolicStep`: Шаг Parabolic SAR, если он выбран
- [x] `ParabolicMax`: Максимум Parabolic SAR, если он выбран

### 4. Управление ордерами
- [ ] *Не используется в MT4. Не реализовано в MT5.* `gFlgOrdPendings`: Разрешить установку отложенных ордеров
- [ ] *Не используется в MT4. Не реализовано в MT5.* `gFlgOrdMarket`: Разрешить установку рыночных ордеров
- [x] `gTPmode`: Использовать Тейкпрофит какого типа?
- [x] `gTP`: Если TP фиксированный, то сколько пунктов?
- [x] `gFiboTP`: Если TP по Fibo, то на каком уровне?
- [x] `gOpenShift`: На сколько пунктов от Hi | Low выставлять ордер?
- [x] `gMaxStopLoss`: Максимальный стоп лосс, пункт
- [ ] *Не используется в MT4. Не реализовано в MT5.* `gFlgMASLinMoment`: SL восстановленных отложек выставлять где?
- [x] `gLifeTime`: Время жизни ордера в часах
- [x] `Close_TPord_on_Time`: Закрывать профитные ордера в конце дня?
- [x] `Hour_closing`: Если закрывать, то в котором часу?

### Безубыток и трейлинг
- [x] `trailingStop`: Какой использовать трейлинг?
    - [x] `Трейлинг ступенчатый`. Активация при `BBUSize`+`BBUSizePip`. Дистанция - `BBUSizePip`.
    - [x] `Трейлинг по ценовому каналу`. Активация при `BBUSize`. Трейлинг по HIGH/LOW ценового канала из `iTralBars` свеч M1 + `DistanceSL`.
    - [x] `Трейлинг по индикаторам (MA и Fractals)`. Активация сразу при открытии сделки. Трейлинг по значению MA + `DistanceSL`. *Индикатор Fractals не используется в боте MT4, поэтому для MT5 тоже не реализован*
- [x] `BBUSize`: Перенос SL в безубыток, если ордер в плюс на...пунктов
- [x] `BBUSizePip`: Уровень безубытка, пункты
- [x] `TrailingStep`: Если трал ступенчатый, то с шагом...пунктов
- [x] `iTralBars`: Если трал по цен.каналу, то сколько баров M1 берем?
- [x] `DistanceSL`: Какой отступ SL от границы канала? (пунктов)

### 5. Второстепенные настройки
- [x] `IsDeletePending`: Удалять отложки в ночную паузу
- [x] `PauseTimeStart`: Время начала ночной паузы
- [x] `PauseTimeStop`: Время окончания ночной паузы
- [x] `gFlgDrawZZ`: Рисовать график ZigZag и уровни торговли SL+TP.
- [ ] *Не используется в MT4. Не реализовано в MT5.* `gFlgLinesHL`: Рисовать линии High и Low?
- [ ] *Не используется в MT4. Не реализовано в MT5.* `gFlgLevelsHL`: Рисовать уровни сделок?
- [x] `11.LL: Log Level`: Уровень логирования
